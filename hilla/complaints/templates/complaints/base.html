{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Support{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Fraunces:opsz,wght@9..144,600;9..144,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'complaints/style.css' %}">
</head>
<body class="theme">
<div class="bg-orbit"></div>

<header class="topbar">
    <div class="container">
        <a class="brand" href="{% url 'index' %}">FixMyCampus</a>
        <nav class="nav">
            <a href="{% url 'create' %}">Create ticket</a>
            <a href="{% url 'api_tickets' %}" target="_blank">API</a>
            <a href="/admin/">Admin</a>
        </nav>
    </div>
</header>

<main class="container">
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    {% block content %}{% endblock %}
</main>

<footer class="site-footer">
  <div class="container footer-grid">
    <div>
      <div class="footer-brand">FixMyCampus</div>
      <p class="small">Built as a civic-style support tracker for campus issues.</p>
    </div>
    <div>
      <div class="footer-title">Social</div>
      <div class="footer-links">
        <a href="https://github.com/Enhilla" target="_blank" rel="noopener">GitHub</a>
        <a href="https://www.instagram.com/enhillahgel/" target="_blank" rel="noopener">Instagram</a>
      </div>
    </div>
    <div>
      <div class="footer-title">Project</div>
      <div class="footer-links">
        <a href="{% url 'create' %}">Create request</a>
        <a href="{% url 'index' %}">All tickets</a>
      </div>
    </div>
  </div>
</footer>

<div class="toast" id="toast" aria-live="polite" aria-atomic="true"></div>

<script>
  (function () {
    const toast = document.getElementById("toast");
    const showToast = (text) => {
      if (!toast) return;
      toast.textContent = text;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2400);
    };

    const openModal = (modal) => {
      if (!modal) return;
      modal.classList.add("open");
      document.body.classList.add("modal-open");
    };

    const closeModal = (modal, withToast = false) => {
      if (!modal) return;
      modal.classList.remove("open");
      document.body.classList.remove("modal-open");
      if (withToast) showToast("Closed");
    };

    document.addEventListener("click", (e) => {
      const trigger = e.target.closest("[data-modal-open]");
      const closeBtn = e.target.closest("[data-modal-close]");
      const copyBtn = e.target.closest("[data-copy-target]");
      const overlay = e.target.classList.contains("modal") ? e.target : null;

      if (trigger) {
        const id = trigger.getAttribute("data-modal-open");
        const modal = document.getElementById(id);
        openModal(modal);
      }

      if (closeBtn) {
        const modal = closeBtn.closest(".modal");
        closeModal(modal, true);
      }

      if (overlay) {
        closeModal(overlay);
      }

      if (copyBtn) {
        const targetId = copyBtn.getAttribute("data-copy-target");
        const target = targetId ? document.getElementById(targetId) : null;
        if (target && target.value) {
          navigator.clipboard.writeText(target.value).then(() => showToast("Copied to clipboard."));
        }
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        document.querySelectorAll(".modal.open").forEach((m) => closeModal(m));
        document.body.classList.remove("modal-open");
      }
    });

    document.querySelectorAll("[data-prompt-template]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const targetId = btn.getAttribute("data-target");
        const target = targetId ? document.getElementById(targetId) : null;
        if (!target) return;
        target.value = btn.getAttribute("data-prompt-template") || "";
        showToast("Prompt template inserted.");
      });
    });
  })();
</script>
</body>
</html>
